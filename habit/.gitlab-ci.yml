test habit:
  extends: .test
  variables:
    SERVICE_FOLDER: habit
  only:
    changes:
      - habit/**/*
  cache:
    paths:
      - habit/build
      - habit/.gradle
  artifacts:
    paths:
      - habit/build/reports/tests/
      - habit/build/test-results/test/TEST-*.xml
      - habit/build/reports/jacoco/test/jacocoTestReport.xml
    reports:
      junit: habit/build/test-results/*/TEST-*.xml

coverage habit:
  extends: .convert-coverage
  variables:
    SERVICE_FOLDER: habit
  only:
    changes:
      - habit/**/*
  needs:
    - test habit
  artifacts:
    reports:
      cobertura: habit/build/cobertura.xml

build habit:
  extends: .build
  variables:
    SERVICE_FOLDER: habit
  only:
    changes:
      - habit/**/*
  needs:
    - test habit
  cache:
    paths:
      - habit/build
      - habit/.gradle
  artifacts:
    paths:
      - habit/build/libs/hc-habit-*.jar

build habit image:
  extends: .docker-build
  variables:
    SERVICE_FOLDER: habit
    IMAGE_NAME: habit
  only:
    changes:
      - habit/**/*
  needs:
    - build habit

publish habit image:
  extends: .docker-publish
  only:
    changes:
      - habit/**/*
  needs:
    - build habit image
  variables:
    IMAGE_NAME: habit
    DOCKER_HUB_REGISTRY_IMAGE: $DOCKER_HUB_REGISTRY_ORG/habit
