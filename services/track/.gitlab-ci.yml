test track:
  extends: .test
  variables:
    SERVICE_FOLDER: track
  only:
    changes:
      - services/track/**/*
  cache:
    paths:
      - services/track/build
      - services/track/.gradle
  artifacts:
    paths:
      - services/track/build/tracks/tests/
      - services/track/build/test-results/test/TEST-*.xml
      - services/track/build/reports/jacoco/test/jacocoTestReport.xml
    reports:
      junit: services/track/build/test-results/*/TEST-*.xml

coverage track:
  extends: .convert-coverage
  variables:
    SERVICE_FOLDER: track
  only:
    changes:
      - services/track/**/*
  needs:
    - test track
  artifacts:
    reports:
      cobertura: services/track/build/cobertura.xml

build track:
  extends: .build
  variables:
    SERVICE_FOLDER: track
  only:
    changes:
      - services/track/**/*
  needs:
    - test track
  cache:
    paths:
      - services/track/build
      - services/track/.gradle
  artifacts:
    paths:
      - services/track/build/libs/hc-track-*.jar

build track image:
  extends: .docker-build
  variables:
    IMAGE_NAME: track
    SERVICE_FOLDER: track
  only:
    changes:
      - services/track/**/*
  needs:
    - build track

publish track image:
  extends: .docker-publish
  only:
    changes:
      - services/track/**/*
  needs:
    - build track image
  variables:
    IMAGE_NAME: track
    DOCKER_HUB_REGISTRY_IMAGE: $DOCKER_HUB_REGISTRY_ORG/track
